From a24350624ecc2460fa917adf8890af92f309ffdd Mon Sep 17 00:00:00 2001
From: Vlad Zahorodnii <vlad.zahorodnii@kde.org>
Date: Mon, 27 Sep 2021 13:02:24 +0300
Subject: [PATCH 1/4] wayland: Destroy InputRedirection explicitly

CCBUG: 442104


(cherry picked from commit 7900068cab6e34e0517439c17438ad544ceb602f)
---
 src/main.cpp         | 5 +++++
 src/main.h           | 1 +
 src/main_wayland.cpp | 1 +
 3 files changed, 7 insertions(+)

diff --git a/src/main.cpp b/src/main.cpp
index c5870356a..93e327b89 100644
--- a/src/main.cpp
+++ b/src/main.cpp
@@ -330,6 +330,11 @@ void Application::removeNativeX11EventFilter()
     removeNativeEventFilter(m_eventFilter.data());
 }
 
+void Application::destroyInput()
+{
+    delete InputRedirection::self();
+}
+
 void Application::destroyWorkspace()
 {
     delete Workspace::self();
diff --git a/src/main.h b/src/main.h
index 606b0669f..30469e3bf 100644
--- a/src/main.h
+++ b/src/main.h
@@ -233,6 +233,7 @@ protected:
     void createColorManager();
     void installNativeX11EventFilter();
     void removeNativeX11EventFilter();
+    void destroyInput();
     void destroyWorkspace();
     void destroyCompositor();
     void destroyPlugins();
diff --git a/src/main_wayland.cpp b/src/main_wayland.cpp
index cb3fc2ac3..a11d75dff 100644
--- a/src/main_wayland.cpp
+++ b/src/main_wayland.cpp
@@ -137,6 +137,7 @@ ApplicationWayland::~ApplicationWayland()
     }
     waylandServer()->terminateClientConnections();
     destroyCompositor();
+    destroyInput();
 }
 
 void ApplicationWayland::performStartup()
-- 
2.32.0

